<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã–zer AÅŸireti | BÃ¼yÃ¼k Divan</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0a192f; color: #333; }
        .header { background: #0a192f; color: white; padding: 15px; text-align: center; border-bottom: 3px solid #ffd700; position: sticky; top:0; z-index:100; }
        
        /* Mesaj AlanÄ± */
        .chat-area { max-width: 850px; margin: 10px auto; background: #f0f2f5; height: 80vh; display: flex; flex-direction: column; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }

        /* LÄ°DER MESAJI (SOLDA) */
        .msg-lider { align-self: flex-start; max-width: 80%; background: #fffdf0; border: 3px solid #ffd700; padding: 15px; border-radius: 0 25px 25px 25px; box-shadow: 5px 5px 15px rgba(255,215,0,0.3); position: relative; }
        .name-lider { color: #b38f00; font-weight: bold; font-size: 16px; border-bottom: 1px solid #ffd700; margin-bottom: 5px; display: block; }

        /* DÄ°ÄERLERÄ° VE BOTLAR (SAÄDA) */
        .msg-diger { align-self: flex-end; max-width: 75%; background: white; padding: 12px; border-radius: 20px 20px 0 20px; border-right: 6px solid #1b5e20; box-shadow: -3px 3px 10px rgba(0,0,0,0.1); }
        .name-diger { color: #1b5e20; font-weight: bold; font-size: 13px; display: block; margin-bottom: 5px; text-align: right; }
        
        /* GÃ–REV ETÄ°KETÄ° */
        .unvan-tag { font-size: 10px; background: #444; color: gold; padding: 2px 8px; border-radius: 5px; margin-left: 5px; vertical-align: middle; }

        /* YETKÄ° VE GÃ–REV PANELÄ° */
        #adminPanel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #0a192f; padding: 25px; border-radius: 20px; display: none; z-index: 1000; border: 3px solid #ffd700; color: white; text-align: center; width: 320px; }
        select { width: 100%; padding: 12px; margin: 15px 0; border-radius: 10px; background: #1a2a44; color: gold; border: 1px solid #ffd700; font-size: 14px; }
        .adm-btn { width: 100%; padding: 12px; margin-top: 10px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: #b30000; color: white; }

        .input-bar { display: flex; padding: 20px; background: white; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 15px; border-radius: 30px; border: 1px solid #ccc; outline: none; }
        .send-btn { background: #b30000; color: white; border: none; padding: 0 30px; border-radius: 30px; margin-left: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <div style="display:flex; justify-content: space-between; max-width: 850px; margin: 0 auto;">
        <a href="index.html" style="color:#ffd700; text-decoration:none; font-size:12px; border:1px solid #ffd700; padding:4px 10px; border-radius:10px;">ğŸ  ANA MENÃœ</a>
        <span id="hosgeldin" style="color:gold; font-weight:bold;">AÅŸiret DivanÄ±</span>
    </div>
</div>

<div id="adminPanel">
    <h3 id="targetName" style="margin:0;">Ä°sim SeÃ§ildi</h3>
    <p style="font-size:12px; color:#aaa;">AÅŸiret gÃ¶revini belirleyin:</p>
    <select id="gorevSecimi">
        <option value="AÅÄ°RET VEKÄ°LÄ°">AÅÄ°RET VEKÄ°LÄ°</option>
        <option value="BAÅ MUHAFIZ">BAÅ MUHAFIZ</option>
        <option value="MALÄ°YE SORUMLUSU">MALÄ°YE SORUMLUSU</option>
        <option value="DIÅ Ä°LÄ°ÅKÄ°LER">DIÅ Ä°LÄ°ÅKÄ°LER</option>
        <option value="Ä°STÄ°HBARAT REÄ°SÄ°">Ä°STÄ°HBARAT REÄ°SÄ°</option>
        <option value="SINIR KOMUTANI">SINIR KOMUTANI</option>
        <option value="TÃ–REN AMÄ°RÄ°">TÃ–REN AMÄ°RÄ°</option>
        <option value="KADÄ°M DANIÅMAN">KADÄ°M DANIÅMAN</option>
        <option value="SÄ°NCAR SORUMLUSU">SÄ°NCAR SORUMLUSU</option>
        <option value="GENÃ‡LÄ°K KOLLARI BAÅKANI">GENÃ‡LÄ°K KOLLARI BÅK.</option>
        <option value="MEDYA SORUMLUSU">MEDYA SORUMLUSU</option>
        <option value="LOJÄ°STÄ°K MÃœDÃœRÃœ">LOJÄ°STÄ°K MÃœDÃœRÃœ</option>
        <option value="ADALET TEMSÄ°LCÄ°SÄ°">ADALET TEMSÄ°LCÄ°SÄ°</option>
        <option value="KALE MUHAFIZI">KALE MUHAFIZI</option>
        <option value="SANCAKDAR">SANCAKDAR</option>
        <option value="AÅÄ°RET SÃ–ZCÃœSÃœ">AÅÄ°RET SÃ–ZCÃœSÃœ</option>
        <option value="BÄ°LGÄ°N">BÄ°LGÄ°N</option>
        <option value="AKSAKAL">AKSAKAL</option>
        <option value="Ã–ZEL KALEM">Ã–ZEL KALEM</option>
        <option value="ÃœYE">SADE ÃœYE</option>
    </select>
    <button class="adm-btn" onclick="gorevAta()">GÃ–REVÄ° MÃœHÃœRLE</button>
    <button class="adm-btn" style="background:gray;" onclick="document.getElementById('adminPanel').style.display='none'">Ä°PTAL</button>
</div>

<div class="chat-area">
    <div class="msgs" id="chatbox"></div>
    <div class="input-bar">
        <input type="text" id="mInp" placeholder="KelamÄ±nÄ±zÄ± yazÄ±n...">
        <button class="send-btn" onclick="gonder()">GÃ–NDER</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBJJEJO1FJCvPMF7n5LXX4DYrf3jBEvTlI",
        authDomain: "ozer-asireti-portal.firebaseapp.com",
        projectId: "ozer-asireti-portal",
        storageBucket: "ozer-asireti-portal.firebasestorage.app",
        messagingSenderId: "76823168812",
        appId: "1:76823168812:web:e21ab7461ac3eec81b4e89"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const adim = localStorage.getItem('asiret_ad') || "Misafir";
    const liderMi = (adim === "Sait Ã–zer" || adim === "Sait Ozer");
    document.getElementById('hosgeldin').innerText = adim + (liderMi ? " ğŸ‘‘" : "");

    const bots = ["Ahmet Ã–zer", "Ali Ã–zer", "Kadir Ã–zer", "Baki Ã–zer", "Kerem Ã–zer", "HACI ABDULLAH Ã–ZER"];
    let seciliUser = "";

    // MESAJLARI VE GÃ–REVLERÄ° DÄ°NLE
    db.collection("sohbet").orderBy("tarih", "asc").onSnapshot(async (snaps) => {
        const box = document.getElementById('chatbox');
        box.innerHTML = "";
        
        // Ã–nce tÃ¼m rÃ¼tbeleri Ã§ekelim
        const rutbeSnap = await db.collection("rutbeler").get();
        const rutbeMap = {};
        rutbeSnap.forEach(doc => rutbeMap[doc.id] = doc.data().rutbe);

        snaps.forEach((doc) => {
            const d = doc.data();
            const isSait = (d.isim === "Sait Ã–zer" || d.isim === "Sait Ozer");
            const classMsg = isSait ? "msg-lider" : "msg-diger";
            const className = isSait ? "name-lider" : "name-diger";
            const gorev = rutbeMap[d.isim] || (isSait ? "LÄ°DER" : "ÃœYE");

            box.innerHTML += `
                <div class="${classMsg}" onclick="panelAc('${d.isim}')">
                    <span class="${className}">${d.isim} <span class="unvan-tag">${gorev}</span></span>
                    <div class="msg-text">${d.mesaj}</div>
                </div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    function gonder() {
        const txt = document.getElementById('mInp').value;
        if(!txt) return;

        db.collection("sohbet").add({
            isim: adim,
            mesaj: txt,
            tarih: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => { akilliBotSistemi(txt); });
        document.getElementById('mInp').value = "";
    }

    function akilliBotSistemi(txt) {
        const k = txt.toLowerCase();
        if(k.includes("selam") || k.includes("merhaba")) {
            botYaz("AleykÃ¼mselam Liderim.", 1200);
            botYaz("HoÅŸ geldiniz aÄŸam, divan emrinizdedir.", 2500);
        } else if(k.includes("nasÄ±lsÄ±n") || k.includes("ne haber")) {
            botYaz("Sizin saÄŸlÄ±ÄŸÄ±nÄ±z bizim huzurumuzdur Sait Bey.", 1500);
            botYaz("ÅÃ¼kÃ¼r aÄŸam, sizi bekliyorduk.", 3000);
        } else {
            botYaz("Sait Bey ne derse o!", 4000);
        }
    }

    function botYaz(m, s) {
        setTimeout(() => {
            db.collection("sohbet").add({
                isim: bots[Math.floor(Math.random()*bots.length)],
                mesaj: m,
                tarih: firebase.firestore.FieldValue.serverTimestamp()
            });
        }, s);
    }

    // PANEL FONKSÄ°YONLARI
    function panelAc(isim) {
        if(liderMi) {
            seciliUser = isim;
            document.getElementById('targetName').innerText = isim;
            document.getElementById('adminPanel').style.display = "block";
        }
    }

    function gorevAta() {
        const yeniGorev = document.getElementById('gorevSecimi').value;
        db.collection("rutbeler").doc(seciliUser).set({ rutbe: yeniGorev }).then(() => {
            alert(seciliUser + " kiÅŸisine '" + yeniGorev + "' gÃ¶revi verildi!");
            document.getElementById('adminPanel').style.display = 'none';
        });
    }
</script>
</body>
</html>
